<div class="fixed inset-0 bg-black/50 flex justify-center items-start pt-20 z-50">
  <div class="bg-white rounded-lg shadow-xl w-[768px] max-h-[calc(100vh-120px)] overflow-y-auto relative">
    <!-- Close button -->
    <button 
      (click)="onClose()"
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <!-- Header -->
    <div class="p-6 border-b">
      <div class="flex-1">
        <input
          *ngIf="editingField === 'title'"
          [formControl]="editForm.controls.title"
          class="text-xl font-semibold w-full border-b focus:outline-none focus:border-blue-500"
          (blur)="saveField('title')"
          (keyup.enter)="saveField('title')"
          #titleInput
        />
        <h2 
          *ngIf="editingField !== 'title'" 
          (click)="startEditing('title')"
          class="text-xl font-semibold cursor-pointer hover:bg-gray-50 p-1 rounded"
        >
          {{task.title}}
        </h2>
      </div>
    </div>

    <!-- Content -->
    <div class="p-6 space-y-6">
      <!-- Description -->
      <div>
        <h3 class="text-sm font-medium text-gray-700 mb-2">Mô tả</h3>
        <textarea
          *ngIf="editingField === 'description'"
          [formControl]="editForm.controls.description"
          class="w-full min-h-[100px] p-3 border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500"
          placeholder="Thêm mô tả chi tiết..."
          (blur)="saveField('description')"
          #descInput
        ></textarea>
        <p *ngIf="editingField !== 'description'" 
           (click)="startEditing('description')"
           class="text-gray-600 cursor-pointer hover:bg-gray-50 p-2 rounded">
          {{task.description ? task.description : 'Thêm mô tả'}}
        </p>
      </div>

      <!-- Metadata -->
      <div class="grid grid-cols-2 gap-4">
        <!-- Deadline -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Thời hạn</h3>
          <div class="cursor-pointer hover:bg-gray-50 p-2 rounded" (click)="openDatePicker()">
            {{ task.deadline ? (task.deadline | date:'dd/MM/yyyy HH:mm') : 'Thêm thời hạn' }}
          </div>
        </div>

        <!-- Priority -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Độ ưu tiên</h3>
          <select
            *ngIf="editingField === 'priority'"
            [(ngModel)]="selectedPriority"
            (blur)="saveField('priority')"
            class="border rounded-md px-3 py-1.5 text-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500"
          >
            <option value="HIGH">Cao</option>
            <option value="MEDIUM">Trung bình</option>
            <option value="LOW">Thấp</option>
          </select>
          <div 
            *ngIf="editingField !== 'priority'"
            (click)="startEditing('priority')" 
            class="flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded"
          >
            <div [ngClass]="{
              'bg-red-400': task.priority === 'HIGH',
              'bg-yellow-400': task.priority === 'MEDIUM',
              'bg-blue-400': task.priority === 'LOW'
            }" class="w-2 h-2 rounded-full"></div>
            <span class="text-gray-600">
              {{ task.priority === 'HIGH' ? 'Cao' : task.priority === 'MEDIUM' ? 'Trung bình' : 'Thấp' }}
            </span>
          </div>
        </div>

        <!-- Status -->
        <div>
          <h3 class="text-sm font-medium text-gray-700 mb-2">Trạng thái</h3>
          <div 
            (click)="startEditing('status')"
            class="cursor-pointer"
          >
            <select
              *ngIf="editingField === 'status'"
              [(ngModel)]="selectedStatus"
              (blur)="saveField('status')"
              (change)="saveField('status')"
              class="border rounded-md px-3 py-1.5 text-gray-600 focus:outline-none focus:ring-1 focus:ring-blue-500"
              #statusInput
            >
              <option value="PENDING">Cần làm</option>
              <option value="IN_PROGRESS">Đang thực hiện</option>
              <option value="COMPLETED">Hoàn thành</option>
              <option value="OVERDUE">Quá hạn</option>
            </select>
            <div 
              *ngIf="editingField !== 'status'"
              [ngClass]="{
                'bg-yellow-100 text-yellow-800': task.status === 'IN_PROGRESS',
                'bg-red-100 text-red-800': task.status === 'OVERDUE',
                'bg-green-100 text-green-800': task.status === 'COMPLETED',
                'bg-gray-100 text-gray-800': task.status === 'PENDING'
              }" 
              class="inline-block px-2 py-1 rounded-full text-sm cursor-pointer hover:opacity-80"
            >
              {{ task.status | taskStatus }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div *ngIf="isEditing" class="px-6 py-4 bg-gray-50 border-t flex justify-end gap-2">
      <button
        (click)="toggleEdit()"
        class="px-4 py-2 text-gray-600 hover:text-gray-800"
      >
        Hủy
      </button>
      <button
        (click)="saveChanges()"
        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
      >
        Lưu thay đổi
      </button>
    </div>

    <!-- Date Picker Modal -->
    <div *ngIf="showDatePicker" class="fixed inset-0 bg-black/50 flex justify-center items-center z-[60]">
      <div class="bg-white rounded-lg shadow-xl p-6 w-[320px]">
        <!-- Header -->
        <div class="mb-6">
          <h2 class="text-lg font-semibold text-gray-800">Đặt thời hạn</h2>
          <p class="text-sm text-gray-500 mt-1">Chọn ngày và giờ đến hạn</p>
        </div>

        <!-- Quick Options -->
        <div class="grid grid-cols-2 gap-2 mb-4">
          <button
            (click)="setQuickDate('today')"
            class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md border transition-colors">
            Hôm nay
          </button>
          <button
            (click)="setQuickDate('tomorrow')"
            class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md border transition-colors">
            Ngày mai
          </button>
          <button
            (click)="setQuickDate('nextWeek')"
            class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md border transition-colors">
            Tuần sau
          </button>
          <button
            (click)="setQuickDate('nextMonth')"
            class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md border transition-colors">
            Tháng sau
          </button>
        </div>

        <!-- Custom DateTime Selector -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Chọn ngày</label>
            <input
              type="date"
              [(ngModel)]="selectedDate"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Chọn giờ</label>
            <input
              type="time"
              [(ngModel)]="selectedTime"
              class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-2 mt-6">
          <button
            (click)="closeDatePicker()"
            class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 transition-colors">
            Hủy
          </button>
          <button
            (click)="saveDateTime()"
            class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
            Xác nhận
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 